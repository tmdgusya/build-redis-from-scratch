# Build Redis in Rust - Event Loop ë§ˆìŠ¤í„° ê³¼ì •

## ì»¤ë¦¬í˜ëŸ¼ ê°œìš”

**mio**ë¥¼ ì‚¬ìš©í•˜ì—¬ Redisì™€ ìœ ì‚¬í•œ ëª…ì‹œì  event loop ì„œë²„ë¥¼ êµ¬ì¶•í•©ë‹ˆë‹¤.

```
ëª©í‘œ ì•„í‚¤í…ì²˜:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Event Loop                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  poll.poll(&mut events, timeout)?       â”‚    â”‚
â”‚  â”‚           â†“                             â”‚    â”‚
â”‚  â”‚  for event in events.iter() {           â”‚    â”‚
â”‚  â”‚      match event.token() {              â”‚    â”‚
â”‚  â”‚          LISTENER => accept(),          â”‚    â”‚
â”‚  â”‚          client   => handle_client(),   â”‚    â”‚
â”‚  â”‚      }                                  â”‚    â”‚
â”‚  â”‚  }                                      â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ë ˆìŠ¨ ëª©ë¡

| # | ì£¼ì œ | í•µì‹¬ ê°œë… | ìƒíƒœ |
|---|------|----------|------|
| 01 | TCP Listener ê¸°ë³¸ | `Poll`, `Token`, `TcpListener` | ğŸ”´ RED |
| 02 | Event Loop êµ¬ì¡° | `poll()`, echo ì„œë²„, ë‹¨ì¼ í´ë¼ì´ì–¸íŠ¸ | ğŸ”´ RED |
| 03 | ë‹¤ì¤‘ ì—°ê²° ì²˜ë¦¬ | `HashMap<Token, TcpStream>` | ğŸ”´ RED |

## í•™ìŠµ ìˆœì„œ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Lesson 01  â”‚â”€â”€â”€â”€â–¶â”‚  Lesson 02  â”‚â”€â”€â”€â”€â–¶â”‚  Lesson 03  â”‚
â”‚  TCP ê¸°ë³¸    â”‚     â”‚  Event Loop â”‚     â”‚  ë‹¤ì¤‘ ì—°ê²°   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚                   â”‚                   â”‚
      â–¼                   â–¼                   â–¼
   bind()            run_once()         HashMap ê´€ë¦¬
   accept_one()      echo ë™ì‘          ë™ì‹œ ì²˜ë¦¬
```

## í•™ìŠµ ë°©ë²• (TDD)

1. ê°•ì˜ìë£Œ ì½ê¸°: `docs/lessons/0X_*.md`
2. í…ŒìŠ¤íŠ¸ ì‹¤í–‰ â†’ **ğŸ”´ RED** (ì‹¤íŒ¨ í™•ì¸)
3. `src/lib.rs` êµ¬í˜„
4. í…ŒìŠ¤íŠ¸ í†µê³¼ â†’ **ğŸŸ¢ GREEN**

## ëª…ë ¹ì–´

```bash
# ë ˆìŠ¨ë³„ í…ŒìŠ¤íŠ¸
make test-01
make test-02
make test-03

# ì „ì²´ í…ŒìŠ¤íŠ¸
make test

# ì„œë²„ ì‹¤í–‰ (êµ¬í˜„ í›„)
make run
```

## í”„ë¡œì íŠ¸ êµ¬ì¡°

```
build-redis/
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ README.md           â† í˜„ì¬ íŒŒì¼
â”‚   â””â”€â”€ lessons/
â”‚       â”œâ”€â”€ 01_tcp_listener.md
â”‚       â”œâ”€â”€ 02_event_loop.md
â”‚       â””â”€â”€ 03_multi_conn.md
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ lib.rs              â† êµ¬í˜„ ëŒ€ìƒ
â”‚   â””â”€â”€ main.rs
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ lesson_01.rs
â”‚   â”œâ”€â”€ lesson_02.rs
â”‚   â””â”€â”€ lesson_03.rs
â””â”€â”€ Makefile
```

## ì‹œì‘í•˜ê¸°

```bash
# 1. ê°•ì˜ìë£Œ ì½ê¸°
cat docs/lessons/01_tcp_listener.md

# 2. í…ŒìŠ¤íŠ¸ ì‹¤í–‰ (RED í™•ì¸)
make test-01

# 3. êµ¬í˜„ í›„ ë‹¤ì‹œ í…ŒìŠ¤íŠ¸ (GREEN ëª©í‘œ)
make test-01
```
